<!DOCTYPE html>
<html lang="en">
<head>
    {{ partial "head.html" . }}

    <style>

        @font-face {
              font-family: 'Satoshi';
              font-style: normal;
              src: url('/fonts/Satoshi.woff2') format('woff2');
              font-display: swap;
              font-weight: 1 999;  
            }

        @font-face {
              font-family: 'Petrona';
              font-style: normal;
              src: url('/fonts/Petrona-Italic.woff2');
              font-display: swap;
              font-weight: 1 999;  
            }

        :root{
            --main: #191919;
            --second: #fff;
        }

        html{
            scroll-behavior: smooth;
        }

        body{
            padding: 5rem 0%;
            font-family: Satoshi, system-ui;
            text-align: center;
            background: var(--second);
            color: var(--main);
        }

        .rain, .rain.back-row  {
          position: fixed;
          left: 0;
          top: 0;
          width: 100vw;
          height: 100vh;
          z-index: 2;
          pointer-events: none;
        }

        .rain.back-row {
          z-index: 1;
          opacity: 0.7;
        }

        .drop {
          position: absolute;
          bottom: 100%;
          width: 15px;
          height: 120px;
          pointer-events: none;
          animation: drop 5s linear infinite;
          opacity: 0.5;
        }

        @keyframes drop {
          0% {
            transform: translateY(0vh);
          }
          75% {
            transform: translateY(112vh);
          }
          100% {
            transform: translateY(112vh);
          }
        }

        .stem {
          width: 1px;
          height: 60%;
          margin-left: 7px;
          background: linear-gradient(to bottom, var(--second), var(--main));
          animation: stem 5s linear infinite;
        }

        @keyframes stem {
          0% {
            opacity: 1;
          }
          65% {
            opacity: 1;
          }
          75% {
            opacity: 0;
          }
          100% {
            opacity: 0;
          }
        }

        .splat {
          width: 20px;
          height: 15px;
          border-top: 2px dotted var(--main);
          border-radius: 50%;
          opacity: 1;
          transform: scale(0);
          animation: splat 5s linear infinite;
        }

        body.splat-toggle .splat {
          display: block;
        }

        @keyframes splat {
          0% {
            opacity: 1;
            transform: scale(0);
          }
          80% {
            opacity: 1;
            transform: scale(0);
          }
          90% {
            opacity: 0.5;
            transform: scale(1);
          }
          100% {
            opacity: 0.2;
            transform: scale(1.5);
          }
        }

        h1{
/*            font-family: Iowan Old Style;*/
            font-size: 3rem;
            margin: 0.5rem 0rem;
            line-height: 1.3em;
            text-align: center;
            font-weight: 100;
            font-variant: normal    ;
        }

        h2{
            line-height: 1.3em;
            font-size: 1.2em;
            text-align: center;
            margin: 6rem 0rem 2rem 0rem;
            font-weight: 900;
            scroll-margin: 2rem;
        }

        p{
            margin: 1.6rem 0rem;
        }

        table{
/*            width: 100%;*/
/*            padding: 1rem 2rem;*/
            margin: 2.5rem auto;
        }

        details{
            border: solid 2px var(--main);
            padding: 1rem;
        }

        summary:hover{
            cursor: pointer;
        }

        summary{
          font-weight: 900;
          font-size: 1.2em;
          font-variant: small-caps;
        }


        td{
            padding: 8px 5rem 0px 0px;
/*            width: 50%;*/
            font-size: 16px;

        }

        .subtitle{
            font-weight: 200;
            font-family: system-ui;
            font-size: 1rem;
            width: 100%;
            text-align: center;
            margin-bottom: 4.5rem;
            letter-spacing: -0.5px;
           }

           @keyframes pulsate {
               0% { 
                   opacity: 0;
               }
               80% { 
                   opacity: 1.0;
               }
               100% { 
                   opacity: 0;
               }
           }

        .grid-2{
            display: flex;
            column-gap: 4rem;
            padding: 4rem 0rem;
            column-count: 2;
            flex-wrap: wrap;
            flex-basis: e;
        }

        .grid-2 .grid-entry{
            width: 50%;
            line-height: 1.5em;
            display: inline-block;
        }

        main{
            max-width: 38rem;
            width: 94%;
            line-height: 1.5em;
            display: inline-block;
            text-align: left;
            font-size: 17px;
            position: relative;
        }

        .portfolio{
            width: 120%;
            margin-left: -10%;
            margin-top: 0rem;
            column-count: 2;
            column-gap: 5%;
        }

        .broad{
            width: 100%;
            margin: 1.6%;
            display: inline-block;
            line-height: 0px;
            box-sizing: border-box;
            border-radius: 3px;
        }

        figcaption{
            font-size: 11px;
            line-height: 1.5em;
            font-style: italic;
            margin-bottom: 1rem;
            color: var(--main);

        }

      /*  .broad:hover .last{
            position: absolute;
        }

        .broad:hover figcaption{
            height: fit-content;
            margin-bottom: 0.75rem;
        }
*/
        img, video{
            width: 100%;
            height: auto;
            margin: 0px;
            margin-bottom: 10px;
            border-radius: 3px;
            box-shadow: 0px 1px 2px #888;
            box-sizing: border-box;
            transition: 0.15s ease all;
        }

        a{
            color: var(--main);
            text-decoration-thickness: 1.5px;
            text-underline-offset: 2px;
            text-decoration-style: dotted;
        }

        p a:hover{
            text-decoration-thickness: 1px;
            text-decoration-style: solid;
            background: rgba(240, 240, 240, 0.8);
            padding: 0px 1.5px;
            border-radius: 5px;
            margin: 0px -1.5px;
        }

        a:hover img, a:hover video{
            box-shadow: 0px 1px 5px #999;
            transform: scale(1.014);
        }

        button{
            background: var(--second);
            color: inherit;
            border: solid 2px var(--main);
            font-size: 1rem;
            cursor: pointer;
            font-family: inherit;
        }

        button:hover{
            opacity: 0.9;
        }

        em{
            font-weight: 300;
        }

        .sidenote-right{
            display: inline;
            position: absolute;
            width: 15rem;
            font-size: 14px;
            line-height: 1.5em;
            font-style: italic;
            font-weight: 200;
            font-family: Palatino, serif;
            margin-left: 105%;
            padding-top: 0.5rem;
        }

        ol, li{
            margin: 1.5rem 0rem;
        }

        blockquote{
            font-family: Petrona, Iowan Old Style, serif;
            font-style: italic;
            font-size: 18px;
            line-height: 1.5em;
            margin: 3rem 3rem 3rem 3rem;
            color: var(--main);
        }

        .subtitle a, blockquote a{
            text-decoration: none;
            box-shadow: 0 0 0 0 rgba(0, 0, 0, 1);
        }


        blockquote a:hover{
            text-decoration: underline;
            text-decoration-thickness: 1.5px;
            text-underline-offset: 3px;
            text-decoration-style: dotted;
            text-decoration-color: #999;
            background: transparent;
        }

        sup{
            font-size: 10px;
        }

        .toc{
            position: fixed;
            top: 40vh;
            left: 2rem;
        }

        .toc a{
            text-decoration: none;
            font-weight: 200;
            display: block;
            margin: 0.4em 0rem;
            color: var(--main);
        }

        .toc a:hover{
            font-weight: 600;
            font-style: normal;
            text-decoration: underline;
            text-decoration-thickness: 1px;
        }

        .post-list {
            margin-top: 3rem;
        }

        .post-content {
            margin-bottom: 5rem;
            padding-bottom: 3rem;
            border-bottom: 1px dotted var(--main);
            scroll-margin-top: 2rem;
        }

        .post-content:last-child {
            border-bottom: none;
        }

        .post-content h2 {
            margin: 1rem 0;
            text-align: left;
            font-size: 1.8em;
        }

        .post-meta {
            font-size: 0.9rem;
            color: #666;
            margin-bottom: 2rem;
        }

        .post-body {
            line-height: 1.7;
        }

        .post-body h2 {
            font-size: 1.4em;
            margin: 2.5rem 0 1rem;
            text-align: left;
        }

        .post-body h3 {
            font-size: 1.2em;
            margin: 2rem 0 1rem;
            text-align: left;
        }

        .post-body ul, .post-body ol {
            margin: 1.5rem 0;
            padding-left: 2rem;
        }

        .post-body li {
            margin: 0.5rem 0;
        }

        @media screen and (max-width: 900px){
            .portfolio{
                width: 100%;
                margin-left: 0%;
            }

            .toc{
                display: none;
            }
        }

        @media screen and (max-width: 600px){

            .portfolio{
                    column-count: 1;
                    margin-top: 0rem;
                }

            .broad{
                margin: 3% 0rem;
            }

            figcaption{
                font-size: 13px;
                line-height: 1.5em;
                font-style: italic;
                overflow: hidden;
                height: fit-content;
                margin-bottom: 0.75rem;

            }

            table{
                margin: 2.5rem 0px;
            }

            td{
                padding: 8px 3rem 0px 0px;
            }

            /*.toc{
                position: relative;
                top: 0vh;
                text-align: center;
                left: 0rem;
                display: block;
                margin-bottom: 4rem;
            }

            .toc a{
                font-weight: 600;
                color: inherit;
            }

            .subtitle{
                margin-bottom: 4rem;
            }*/
        }


        .container {
            width: 100vw;
            height: 100vh;
            position: fixed;
            top: 0px;
            left: 0px;
            background-color: transparent;
            pointer-events: none;
        }

        .boid {
            width: 10px;
            height: 3px;
            background-color: var(--main);
            position: absolute;
            border-radius: 100%;
        }

        .raindrop {
            width: 1.2px;
            height: 25px;
            background-color: var(--main);
            position: absolute;
            bottom: 100%;
            animation: fall linear infinite;
        }

        @keyframes fall {
            to {
                transform: translateY(100vh);
            }
        }

        .mode{
            position: fixed;
            top: 10px;
            right: 10px;
            font-weight: 200;
            border: none;
        }

        .post-filter {
            position: fixed;
            top: 10px;
            left: 10px;
            font-weight: 200;
            border: none;
        }

    </style>
</head>

<body class="back-row-toggle splat-toggle">
  <div class="rain front-row"></div>
  <div class="rain back-row"></div>
    <main>
        <h1> Defective Altruist</h1>

        <div class="container" id=container>
        </div>

        <button class="mode" onclick="switchColors()"> dark/light </button>
        <button class="post-filter" onclick="togglePostFilter()">all</button>


        <div class=toc>
            {{ range where .Site.RegularPages "Section" "" }}
            <a href="#{{ .File.BaseFileName }}" id="toc-{{ .File.BaseFileName }}">{{ .Title }}</a>
            {{ end }}
        </div>

        {{ .Content }}

        <div class="post-list">
            {{ range where .Site.RegularPages "Section" "" }}
            <div class="post-content" id="{{ .File.BaseFileName }}" data-type="{{ .Params.type }}">
                <h2>{{ .Title }}</h2>
                <div class="post-meta">
                    {{ if .Date }}
                    <time datetime="{{ .Date.Format "2006-01-02T15:04:05Z07:00" }}">
                        {{ .Date.Format "January 2, 2006" }}
                    </time>
                    {{ end }}
                </div>
                <div class="post-body">
                    {{ .Content }}
                </div>
            </div>
            {{ end }}
        </div>

        

    </main>

    <footer style="font-size: 0.9rem; color: var(--main); text-align: center;">
        Design inspiration from <a href="https://github.com/joodaloop/webcraft" style="text-decoration: none; border-bottom: 1px dotted var(--main);">Judah</a>
    </footer>

    <script>

        const root = document.documentElement;

        function switchColors() {
            const mainColor = getComputedStyle(root).getPropertyValue('--main');
            const secondColor = getComputedStyle(root).getPropertyValue('--second');

            root.style.setProperty('--main', secondColor);
            root.style.setProperty('--second', mainColor);
        }

        // Post filter functionality
        let currentFilter = 'all'; // Default to showing both types of posts

        function togglePostFilter() {
            const filterButton = document.querySelector('.post-filter');
            const posts = document.querySelectorAll('.post-content');
            const tocLinks = document.querySelectorAll('.toc a');
            
            // Cycle through filter options: both -> main -> thought -> both
            if (currentFilter === 'all') {
                currentFilter = 'posts';
            } else if (currentFilter === 'posts') {
                currentFilter = 'thoughts';
            } else {
                currentFilter = 'all';
            }
            
            // Update button text
            filterButton.textContent = currentFilter;
            
            // Show/hide posts based on filter
            posts.forEach(post => {
                const postType = post.getAttribute('data-type') || '';
                const postId = post.id;
                const tocLink = document.getElementById('toc-' + postId);
                
                if (currentFilter === 'all' || postType === currentFilter) {
                    post.style.display = 'block';
                    if (tocLink) tocLink.style.display = 'block';
                } else {
                    post.style.display = 'none';
                    if (tocLink) tocLink.style.display = 'none';
                }
            });
        }



        let prevID = "the-problem"

        function getCurrentHeadingId() {
          // Get all the <h2> elements in the document
          const headings = Array.from(document.getElementsByTagName('h2'));

          // Function to check if an element is in the viewport
          function isElementInViewport(element) {
            const rect = element.getBoundingClientRect();
            return (
              rect.top >= 0 &&
              rect.left >= 0 &&
              rect.bottom <= (window.innerHeight || document.documentElement.clientHeight) &&
              rect.right <= (window.innerWidth || document.documentElement.clientWidth)
            );
          }

          // Find the first <h2> element in the viewport
          const currentHeading = headings.find(isElementInViewport);

          // Retrieve the ID of the current <h2> element
          const currentHeadingId = currentHeading ? currentHeading.id : null;

          return currentHeadingId;
        }

        // Call the function and retrieve the current heading ID
        const currentId = getCurrentHeadingId();

        document.addEventListener("scroll", () => {
            // Get all post content sections
            const postSections = Array.from(document.querySelectorAll('.post-content'));
            
            // Find which section is currently in view
            let currentSection = null;
            
            for (const section of postSections) {
                const rect = section.getBoundingClientRect();
                // If the top of the section is in the viewport or just above it
                if (rect.top <= 100 && rect.bottom > 0) {
                    currentSection = section.id;
                    break;
                }
            }
            
            // If no section is found, use the previous one
            currentSection = currentSection ?? prevID;
            prevID = currentSection;
            
            // Reset all TOC links to normal weight
            const tocLinks = document.querySelectorAll('.toc a');
            tocLinks.forEach(link => {
                link.style.fontWeight = "200";
            });
            
            // Highlight the current section in the TOC
            if (currentSection) {
                const currentTocLink = document.getElementById("toc-" + currentSection);
                if (currentTocLink) {
                    currentTocLink.style.fontWeight = "800";
                }
            }
        });

    </script>
</body>

</html>
